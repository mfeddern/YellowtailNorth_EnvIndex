<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.0.36">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>LinearModelsEnvPred</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>


<script src="LinearModelsDredge_files/libs/clipboard/clipboard.min.js"></script>
<script src="LinearModelsDredge_files/libs/quarto-html/quarto.js"></script>
<script src="LinearModelsDredge_files/libs/quarto-html/popper.min.js"></script>
<script src="LinearModelsDredge_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="LinearModelsDredge_files/libs/quarto-html/anchor.min.js"></script>
<link href="LinearModelsDredge_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="LinearModelsDredge_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="LinearModelsDredge_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="LinearModelsDredge_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="LinearModelsDredge_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


<link rel="stylesheet" href="styles.css">
</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#background" id="toc-background" class="nav-link active" data-scroll-target="#background">Background</a></li>
  <li><a href="#code-set-up" id="toc-code-set-up" class="nav-link" data-scroll-target="#code-set-up">Code set up</a></li>
  <li><a href="#evaluating-multicolinearity-and-temporal-stability-of-environmental-predictors" id="toc-evaluating-multicolinearity-and-temporal-stability-of-environmental-predictors" class="nav-link" data-scroll-target="#evaluating-multicolinearity-and-temporal-stability-of-environmental-predictors">1. Evaluating multicolinearity and temporal stability of environmental predictors</a>
  <ul class="collapse">
  <li><a href="#running-a-dfa" id="toc-running-a-dfa" class="nav-link" data-scroll-target="#running-a-dfa">Running a DFA</a></li>
  <li><a href="#assessing-the-weight-of-support-for-each-predictor-as-a-function-of-time-series-length" id="toc-assessing-the-weight-of-support-for-each-predictor-as-a-function-of-time-series-length" class="nav-link" data-scroll-target="#assessing-the-weight-of-support-for-each-predictor-as-a-function-of-time-series-length">Assessing the weight of support for each predictor as a function of time series length</a></li>
  <li><a href="#assessing-model-selection-based-on-aic-and-principles-of-parsimony" id="toc-assessing-model-selection-based-on-aic-and-principles-of-parsimony" class="nav-link" data-scroll-target="#assessing-model-selection-based-on-aic-and-principles-of-parsimony">Assessing model selection based on AIC and principles of parsimony</a></li>
  <li><a href="#considering-correlation-across-covariates-with-the-strongest-weights-of-evidence" id="toc-considering-correlation-across-covariates-with-the-strongest-weights-of-evidence" class="nav-link" data-scroll-target="#considering-correlation-across-covariates-with-the-strongest-weights-of-evidence">Considering correlation across covariates with the strongest weights of evidence</a></li>
  </ul></li>
  <li><a href="#univariate-gams" id="toc-univariate-gams" class="nav-link" data-scroll-target="#univariate-gams">Univariate GAMs</a></li>
  <li><a href="#next-steps" id="toc-next-steps" class="nav-link" data-scroll-target="#next-steps">Next steps</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">LinearModelsEnvPred</h1>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header>

<section id="background" class="level2">
<h2 class="anchored" data-anchor-id="background">Background</h2>
<p>The northern Yellowtail STAT has identified 3 primary ways that the incorporation and evaluation of environmental indices could be improved upon for the 2025 assessment cycle, these include:</p>
<ol type="1">
<li><p>Expand on non-linear relationships considered between recruitment deviations and environmental responses, specifically, evaluate the benefit of using GAMs in addition to quadratic terms.</p></li>
<li><p>Compare predictive capacity of models (using Leave-Future-Out cross validation) in addition to model fit.</p></li>
<li><p>Consider time-varying relationships (non-stationarity) between environmental conditions and recruitment deviations.</p></li>
<li><p>Fitting models to recrutitment deviations from the base model and refitting with an environmental predictor has inherent circularity. Identifying additional indices that can be environmentally informed would benefit the process of developing environmentally informed assessments. These could include indices of juvenile abundance, growth, or maturity.</p></li>
<li><p>Methods for index selection currently include fitting all possible model combintations. Issues of multicollinearity and model fitting are challenging across assessment types (i.e.&nbsp;both groundfish and salmon struggle with this). Evaluating additional approaches to deal with both multicollinearity and variable selection that also can deal with extremely limited time series would be beneficial. These can include regularization and machine learning methods.</p></li>
</ol>
<p>These efforts are in addition to the work lead by Nick Tolmieri and Amanda Darby which</p>
<ol type="1">
<li><p>Generated a ecological profile for Yellowtail north based on life history information</p></li>
<li><p>Compared linear models including quadratic terms where aappropriate and omitting highly correlated predictors from the same model</p></li>
<li><p>Found the model with the best fit to the data using AIC and principles of parsimony</p></li>
<li><p>Evaluated model performance using jack knifing and predicting the last 4 years of data.</p></li>
</ol>
</section>
<section id="code-set-up" class="level2">
<h2 class="anchored" data-anchor-id="code-set-up">Code set up</h2>
<p>First we set up the appropriate packages and references. File paths will be in reference to where the .qmd is saved</p>
<div class="cell">

</div>
<p>Next we set up the appropriate directories and read in the data.</p>
<div class="cell">

</div>
<p>We can build the functions including quadratic terms and omitting data that are missing years. We pull out DDegg just so we do not exceed the limit of 31 terms - pulling this out was somewhat arbitrary based on Amandas perliminary results.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Y_rec ~ X + DDpre + DDlarv + DDpjuv + DDben + Tcop + Tpart + 
    MLDpart + MLDlarv + MLDpjuv + CSTlarv + CSTpjuv + LSTlarv + 
    LSTpjuv + HCIlarv + HCIpjuv + ONIpre + ONIlarv + ONIpjuv + 
    PDOlarv + PDOpjuv + LUSI + CutiSTIpjuv + CutiTUMIpjuv + BeutiTUMIpjuv + 
    BeutiSTIpjuv + bakun_sti + header + I(LSTlarv^2) + I(ONIpre^2) + 
    I(ONIlarv^2) + I(CutiSTIpjuv^2)
&lt;environment: 0x7fe660f39060&gt;</code></pre>
</div>
</div>
</section>
<section id="evaluating-multicolinearity-and-temporal-stability-of-environmental-predictors" class="level2">
<h2 class="anchored" data-anchor-id="evaluating-multicolinearity-and-temporal-stability-of-environmental-predictors">1. Evaluating multicolinearity and temporal stability of environmental predictors</h2>
<section id="running-a-dfa" class="level3">
<h3 class="anchored" data-anchor-id="running-a-dfa">Running a DFA</h3>
<p>Before we fit models, lets first understand patterns of correlation and covariability across these environmnetal conditions. To start, lets look at a DFA. We find that across time series, there is a strong underlying trend that is predominantly loaded on by temperature time series and represents transport, mixed layer depth, and upwelling are not as well represented. The model struggles to converge with more than one latent trend.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="LinearModelsDredge_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="assessing-the-weight-of-support-for-each-predictor-as-a-function-of-time-series-length" class="level3">
<h3 class="anchored" data-anchor-id="assessing-the-weight-of-support-for-each-predictor-as-a-function-of-time-series-length">Assessing the weight of support for each predictor as a function of time series length</h3>
<p>Next we can look at the weight of evidence in support for each time series and consider how this might change based on the observed time period of recruitment deviations. For this approach we will dredge up to 5 covariates, we will consider quadratic terms, and omit combinations of highly correlated covariates. This is not to expressly identify “THE” model but as an exercise to identify the most important variables, and potential non-stationarities in that relationship. To fit these models we will use at least 10 years of data (1994 - 2004) and iteratively add in one year of data and refit the model set. Colors denote the over all aic weight across all models with that variable.</p>
<p>Two variables stand out, CUTI spring transition as a non-linear (quadratic) relationship and ONI during the preconditioning time period. Notably, the weight of evidence for a single time series really diminshes when when the model is fit to 1994 - 2011:2014 such that AIC is fairly distributed across time series.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="LinearModelsDredge_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>If we try to fit a model that is highly parsimonious, by fitting only 1 covariate at a time in the same framework (or selecting the most parsimonious model) we get a different answer and find that Mixed layer depth during the larval lifestage is the most important. I find this result interesting because MLDlarv does not load onto our DFA significantly. Given all of this variability, its worth exploring these different models a bit more.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="LinearModelsDredge_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="assessing-model-selection-based-on-aic-and-principles-of-parsimony" class="level3">
<h3 class="anchored" data-anchor-id="assessing-model-selection-based-on-aic-and-principles-of-parsimony">Assessing model selection based on AIC and principles of parsimony</h3>
<p>Lets take a look at what the best models from Amanda and Nicks workflow looks like. If we assign the best model as the model with the lowest AIC we also identify the MLDlarv model. However, this model has an extremely low R^2 and also does not fit the most recent half of the time series.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="LinearModelsDredge_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Now what if we relax teh requirement of having the most parsimonious model and instead focus on the best fit across the entire time series, we find the best model is CUTI STI with a quadratic term.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="LinearModelsDredge_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We can also look at a table of the best models. It becomes very apparent the top models include CUTI STI as a non-linear term, and the models that include it have much better R^2 values.</p>
<div class="cell">
<div class="cell-output-display">

<table>
 <thead>
  <tr>
   <th style="text-align:right;"> CutiSTIpjuv </th>
   <th style="text-align:right;"> I.CutiSTIpjuv.2. </th>
   <th style="text-align:right;"> DDpre </th>
   <th style="text-align:right;"> HCIlarv </th>
   <th style="text-align:right;"> MLDlarv </th>
   <th style="text-align:right;"> Tcop </th>
   <th style="text-align:right;"> R2 </th>
   <th style="text-align:right;"> AICc </th>
   <th style="text-align:right;"> delta </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:right;"> -0.22 </td>
   <td style="text-align:right;"> -0.30 </td>
   <td style="text-align:right;"> NA </td>
   <td style="text-align:right;"> NA </td>
   <td style="text-align:right;"> NA </td>
   <td style="text-align:right;"> NA </td>
   <td style="text-align:right;"> 0.37 </td>
   <td style="text-align:right;"> 27.12 </td>
   <td style="text-align:right;"> 0.00 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> -0.23 </td>
   <td style="text-align:right;"> -0.28 </td>
   <td style="text-align:right;"> NA </td>
   <td style="text-align:right;"> NA </td>
   <td style="text-align:right;"> NA </td>
   <td style="text-align:right;"> 0.21 </td>
   <td style="text-align:right;"> 0.44 </td>
   <td style="text-align:right;"> 28.16 </td>
   <td style="text-align:right;"> 1.04 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> NA </td>
   <td style="text-align:right;"> NA </td>
   <td style="text-align:right;"> NA </td>
   <td style="text-align:right;"> NA </td>
   <td style="text-align:right;"> 0.16 </td>
   <td style="text-align:right;"> NA </td>
   <td style="text-align:right;"> 0.21 </td>
   <td style="text-align:right;"> 28.79 </td>
   <td style="text-align:right;"> 1.67 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> -0.23 </td>
   <td style="text-align:right;"> -0.27 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> NA </td>
   <td style="text-align:right;"> NA </td>
   <td style="text-align:right;"> NA </td>
   <td style="text-align:right;"> 0.42 </td>
   <td style="text-align:right;"> 28.90 </td>
   <td style="text-align:right;"> 1.78 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> -0.20 </td>
   <td style="text-align:right;"> -0.24 </td>
   <td style="text-align:right;"> NA </td>
   <td style="text-align:right;"> NA </td>
   <td style="text-align:right;"> 0.09 </td>
   <td style="text-align:right;"> NA </td>
   <td style="text-align:right;"> 0.41 </td>
   <td style="text-align:right;"> 28.99 </td>
   <td style="text-align:right;"> 1.87 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> -0.26 </td>
   <td style="text-align:right;"> -0.28 </td>
   <td style="text-align:right;"> NA </td>
   <td style="text-align:right;"> -0.32 </td>
   <td style="text-align:right;"> NA </td>
   <td style="text-align:right;"> NA </td>
   <td style="text-align:right;"> 0.41 </td>
   <td style="text-align:right;"> 29.09 </td>
   <td style="text-align:right;"> 1.97 </td>
  </tr>
</tbody>
</table>

</div>
</div>
</section>
<section id="considering-correlation-across-covariates-with-the-strongest-weights-of-evidence" class="level3">
<h3 class="anchored" data-anchor-id="considering-correlation-across-covariates-with-the-strongest-weights-of-evidence">Considering correlation across covariates with the strongest weights of evidence</h3>
<p>Using the first framework we look at, we can take the entire time series through 2014, and look at what predictors have the most evidence of support. Lets say that we only want to look at predictors that have at least 15% of the model support for the full time series. Looking at the data this way, the covariates that have the best weight of evidence are: long shore transport (larv), ONI (pelagic juveniles, larval, and preconditioning), CUTI STI, degree days benthic juveniles, and mixed layer depth larval.</p>
<div class="cell">
<div class="cell-output-display">

<table>
 <thead>
  <tr>
   <th style="text-align:right;"> last_year </th>
   <th style="text-align:left;"> variable </th>
   <th style="text-align:right;"> value </th>
   <th style="text-align:left;"> indicator </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:right;"> 2014 </td>
   <td style="text-align:left;"> MLDlarv </td>
   <td style="text-align:right;"> 0.2060605 </td>
   <td style="text-align:left;"> MLDla </td>
  </tr>
</tbody>
</table>

</div>
</div>
<p>Thinking about the variables with the most weight of evidence, we can test out a backwards selection technique. Instead of AIC (which is prone to overfitting and we already know these variables have AIC support) we can use VIF to try and avoid multicollinerity. Lets start with the model that is saturated with the variables that have strong AIC support.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>    LSTlarv     ONIpjuv     ONIlarv      ONIpre CutiSTIpjuv     MLDpjuv 
       1.88        2.91       32.64       28.47        1.36        1.63 
      DDben 
       1.88 </code></pre>
</div>
<div class="cell-output-display">
<p><img src="LinearModelsDredge_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>ONIlarv is correlated with a bunch of covariates. Lets ditch it.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>    LSTlarv     ONIpjuv      ONIpre CutiSTIpjuv     MLDpjuv       DDben 
       1.62        2.26        1.25        1.35        1.47        1.88 </code></pre>
</div>
<div class="cell-output-display">
<p><img src="LinearModelsDredge_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>And finally, what does this model look like? We get a slightly worse fit than just using upwelling, and we still struggle with overestimating recruitment when it is low (the negative values)</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="LinearModelsDredge_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We don’t want to use DFA latent trends as predictors because they lack transparency and interpretability - but lets look at it…it is GARBAGE. Why? Likely because it is dominated by temperature and not influenced by the transport, upwelling and mixed layer depth variables that provide better fits. Therefore, even using a DFA would require some degree of covariate exploration for any explanatory power or predictive ability.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="LinearModelsDredge_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The fact that the correlation between CUTI STI and yellowtail rec devs changes in 2010/2011 is suspicious given it is modeled from ROMS data and ROMS models also changed over that period. To evaluate whether this is this may be the cause of the change we looked at the time series of CUTI STI along with comparing it to Bakun derived STI to see if Bakun indices offer a reasonable alternative that may not be subject to changes in ROMS around 2010. CUTI and Bakun STI are only moderately correlated (0.52) and we don’t find that there are significant differences in CUTI STI before and after 2010. Mike Jacox confirmed that there the wind data that CUTI is derived from should be stable from ROMs from at least 2000 onward. He also said he may have CUTI from GLORYs somewhere on his computer (need to follow up).</p>
<p>From Kiva: “I included all years of”main” recruitment deviations. I would say the information quality goes down around 2010-2011, but you could use anything for playing around.” This may partially explain the lack of consistency after 2010/2011</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="LinearModelsDredge_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>            CutiSTIpjuv bakun_sti
CutiSTIpjuv   1.0000000 0.5243211
bakun_sti     0.5243211 1.0000000</code></pre>
</div>
<div class="cell-output-display">
<p><img src="LinearModelsDredge_files/figure-html/unnamed-chunk-15-2.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = CutiSTIpjuv ~ ROMS, data = up)

Residuals:
    Min      1Q  Median      3Q     Max 
-1.6975 -0.7755  0.1243  0.6157  2.0076 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)
(Intercept) -0.06597    0.21074  -0.313    0.756
ROMSlate     0.19242    0.35991   0.535    0.596

Residual standard error: 1.011 on 33 degrees of freedom
Multiple R-squared:  0.008587,  Adjusted R-squared:  -0.02146 
F-statistic: 0.2858 on 1 and 33 DF,  p-value: 0.5965</code></pre>
</div>
</div>
</section>
</section>
<section id="univariate-gams" class="level2">
<h2 class="anchored" data-anchor-id="univariate-gams">Univariate GAMs</h2>
<p>Here I fit univariate GAMs to evaluate the differences in AIC, Leave-One-Out Cross Validation, and Leave-Future-Out Cross Validation. The goal of this preliminary analysis before fitting multivariate GAMs was to examine more closely how different variables perform with particular attention to fits versus predictive capacity. Plotting model fits with a single variable is usedful for understanding which patterns in the data are explained by each variable.</p>
<p>First, lets look at which models have the most support based on a) AIC, b) LOO-CV, and c) LFO-CV.</p>
<div class="cell">
<div class="cell-output-display">

<table>
 <thead>
  <tr>
   <th style="text-align:left;"> var </th>
   <th style="text-align:right;"> RMSE_LOO </th>
   <th style="text-align:right;"> RMSE_LFO </th>
   <th style="text-align:right;"> AIC_LOO </th>
   <th style="text-align:right;"> rsq_LOO </th>
   <th style="text-align:right;"> rsq_LFO </th>
   <th style="text-align:right;"> dev.ex_LOO </th>
   <th style="text-align:right;"> dev.ex_LFO </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> CutiSTIpjuv </td>
   <td style="text-align:right;"> 0.432 </td>
   <td style="text-align:right;"> 0.389 </td>
   <td style="text-align:right;"> 24.94231 </td>
   <td style="text-align:right;"> 0.28 </td>
   <td style="text-align:right;"> 0.39 </td>
   <td style="text-align:right;"> 0.3494 </td>
   <td style="text-align:right;"> 0.4616 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> LSTlarv </td>
   <td style="text-align:right;"> 0.433 </td>
   <td style="text-align:right;"> 0.210 </td>
   <td style="text-align:right;"> 27.62118 </td>
   <td style="text-align:right;"> 0.18 </td>
   <td style="text-align:right;"> 0.15 </td>
   <td style="text-align:right;"> 0.2562 </td>
   <td style="text-align:right;"> 0.2382 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> MLDlarv </td>
   <td style="text-align:right;"> 0.436 </td>
   <td style="text-align:right;"> 0.328 </td>
   <td style="text-align:right;"> 27.37569 </td>
   <td style="text-align:right;"> 0.16 </td>
   <td style="text-align:right;"> 0.23 </td>
   <td style="text-align:right;"> 0.2052 </td>
   <td style="text-align:right;"> 0.3036 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> DDpre </td>
   <td style="text-align:right;"> 0.460 </td>
   <td style="text-align:right;"> 0.210 </td>
   <td style="text-align:right;"> 29.95140 </td>
   <td style="text-align:right;"> 0.05 </td>
   <td style="text-align:right;"> 0.03 </td>
   <td style="text-align:right;"> 0.1015 </td>
   <td style="text-align:right;"> 0.0931 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Tcop </td>
   <td style="text-align:right;"> 0.462 </td>
   <td style="text-align:right;"> 0.245 </td>
   <td style="text-align:right;"> 30.18503 </td>
   <td style="text-align:right;"> 0.04 </td>
   <td style="text-align:right;"> 0.04 </td>
   <td style="text-align:right;"> 0.0915 </td>
   <td style="text-align:right;"> 0.0963 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> MLDpart </td>
   <td style="text-align:right;"> 0.473 </td>
   <td style="text-align:right;"> 0.293 </td>
   <td style="text-align:right;"> 28.64629 </td>
   <td style="text-align:right;"> 0.11 </td>
   <td style="text-align:right;"> 0.13 </td>
   <td style="text-align:right;"> 0.1556 </td>
   <td style="text-align:right;"> 0.1874 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> DDegg </td>
   <td style="text-align:right;"> 0.479 </td>
   <td style="text-align:right;"> 0.266 </td>
   <td style="text-align:right;"> 31.09455 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.0512 </td>
   <td style="text-align:right;"> 0.0636 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> X </td>
   <td style="text-align:right;"> 0.482 </td>
   <td style="text-align:right;"> 0.295 </td>
   <td style="text-align:right;"> 30.19527 </td>
   <td style="text-align:right;"> 0.06 </td>
   <td style="text-align:right;"> 0.04 </td>
   <td style="text-align:right;"> 0.1178 </td>
   <td style="text-align:right;"> 0.1013 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> ONIpjuv </td>
   <td style="text-align:right;"> 0.483 </td>
   <td style="text-align:right;"> 0.309 </td>
   <td style="text-align:right;"> 30.48603 </td>
   <td style="text-align:right;"> 0.03 </td>
   <td style="text-align:right;"> 0.06 </td>
   <td style="text-align:right;"> 0.0783 </td>
   <td style="text-align:right;"> 0.1153 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> DDlarv </td>
   <td style="text-align:right;"> 0.484 </td>
   <td style="text-align:right;"> 0.218 </td>
   <td style="text-align:right;"> 31.01117 </td>
   <td style="text-align:right;"> 0.01 </td>
   <td style="text-align:right;"> -0.02 </td>
   <td style="text-align:right;"> 0.0550 </td>
   <td style="text-align:right;"> 0.0456 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> PDOpjuv </td>
   <td style="text-align:right;"> 0.486 </td>
   <td style="text-align:right;"> 0.349 </td>
   <td style="text-align:right;"> 31.75613 </td>
   <td style="text-align:right;"> -0.03 </td>
   <td style="text-align:right;"> 0.01 </td>
   <td style="text-align:right;"> 0.0209 </td>
   <td style="text-align:right;"> 0.0697 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Tpart </td>
   <td style="text-align:right;"> 0.491 </td>
   <td style="text-align:right;"> 0.220 </td>
   <td style="text-align:right;"> 31.30430 </td>
   <td style="text-align:right;"> -0.01 </td>
   <td style="text-align:right;"> -0.03 </td>
   <td style="text-align:right;"> 0.0417 </td>
   <td style="text-align:right;"> 0.0331 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> HCIlarv </td>
   <td style="text-align:right;"> 0.493 </td>
   <td style="text-align:right;"> 0.217 </td>
   <td style="text-align:right;"> 31.45804 </td>
   <td style="text-align:right;"> -0.02 </td>
   <td style="text-align:right;"> -0.04 </td>
   <td style="text-align:right;"> 0.0347 </td>
   <td style="text-align:right;"> 0.0240 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> CutiTUMIpjuv </td>
   <td style="text-align:right;"> 0.493 </td>
   <td style="text-align:right;"> 0.262 </td>
   <td style="text-align:right;"> 32.18672 </td>
   <td style="text-align:right;"> -0.05 </td>
   <td style="text-align:right;"> -0.06 </td>
   <td style="text-align:right;"> 0.0006 </td>
   <td style="text-align:right;"> 0.0072 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> DDben </td>
   <td style="text-align:right;"> 0.498 </td>
   <td style="text-align:right;"> 0.238 </td>
   <td style="text-align:right;"> 31.87787 </td>
   <td style="text-align:right;"> -0.04 </td>
   <td style="text-align:right;"> -0.05 </td>
   <td style="text-align:right;"> 0.0152 </td>
   <td style="text-align:right;"> 0.0128 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> ONIpre </td>
   <td style="text-align:right;"> 0.499 </td>
   <td style="text-align:right;"> 0.463 </td>
   <td style="text-align:right;"> 29.86055 </td>
   <td style="text-align:right;"> 0.09 </td>
   <td style="text-align:right;"> 0.23 </td>
   <td style="text-align:right;"> 0.1665 </td>
   <td style="text-align:right;"> 0.3226 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> dfa </td>
   <td style="text-align:right;"> 0.500 </td>
   <td style="text-align:right;"> 0.222 </td>
   <td style="text-align:right;"> 31.73622 </td>
   <td style="text-align:right;"> -0.03 </td>
   <td style="text-align:right;"> -0.05 </td>
   <td style="text-align:right;"> 0.0218 </td>
   <td style="text-align:right;"> 0.0124 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> LSTpjuv </td>
   <td style="text-align:right;"> 0.501 </td>
   <td style="text-align:right;"> 0.261 </td>
   <td style="text-align:right;"> 32.18613 </td>
   <td style="text-align:right;"> -0.05 </td>
   <td style="text-align:right;"> -0.06 </td>
   <td style="text-align:right;"> 0.0006 </td>
   <td style="text-align:right;"> 0.0069 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> BeutiTUMIpjuv </td>
   <td style="text-align:right;"> 0.502 </td>
   <td style="text-align:right;"> 0.231 </td>
   <td style="text-align:right;"> 31.98426 </td>
   <td style="text-align:right;"> -0.04 </td>
   <td style="text-align:right;"> -0.06 </td>
   <td style="text-align:right;"> 0.0102 </td>
   <td style="text-align:right;"> 0.0058 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> PDOlarv </td>
   <td style="text-align:right;"> 0.504 </td>
   <td style="text-align:right;"> 0.203 </td>
   <td style="text-align:right;"> 31.25609 </td>
   <td style="text-align:right;"> -0.01 </td>
   <td style="text-align:right;"> -0.04 </td>
   <td style="text-align:right;"> 0.0439 </td>
   <td style="text-align:right;"> 0.0272 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> BeutiSTIpjuv </td>
   <td style="text-align:right;"> 0.506 </td>
   <td style="text-align:right;"> 0.275 </td>
   <td style="text-align:right;"> 31.20045 </td>
   <td style="text-align:right;"> 0.02 </td>
   <td style="text-align:right;"> 0.05 </td>
   <td style="text-align:right;"> 0.0943 </td>
   <td style="text-align:right;"> 0.1483 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> DDpjuv </td>
   <td style="text-align:right;"> 0.516 </td>
   <td style="text-align:right;"> 0.237 </td>
   <td style="text-align:right;"> 32.11044 </td>
   <td style="text-align:right;"> -0.05 </td>
   <td style="text-align:right;"> -0.07 </td>
   <td style="text-align:right;"> 0.0042 </td>
   <td style="text-align:right;"> 0.0005 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> HCIpjuv </td>
   <td style="text-align:right;"> 0.516 </td>
   <td style="text-align:right;"> 0.253 </td>
   <td style="text-align:right;"> 31.86014 </td>
   <td style="text-align:right;"> -0.02 </td>
   <td style="text-align:right;"> -0.05 </td>
   <td style="text-align:right;"> 0.0513 </td>
   <td style="text-align:right;"> 0.0224 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> CSTlarv </td>
   <td style="text-align:right;"> 0.526 </td>
   <td style="text-align:right;"> 0.248 </td>
   <td style="text-align:right;"> 32.19784 </td>
   <td style="text-align:right;"> -0.05 </td>
   <td style="text-align:right;"> -0.07 </td>
   <td style="text-align:right;"> 0.0001 </td>
   <td style="text-align:right;"> 0.0006 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> MLDpjuv </td>
   <td style="text-align:right;"> 0.531 </td>
   <td style="text-align:right;"> 0.240 </td>
   <td style="text-align:right;"> 32.13528 </td>
   <td style="text-align:right;"> -0.05 </td>
   <td style="text-align:right;"> -0.06 </td>
   <td style="text-align:right;"> 0.0030 </td>
   <td style="text-align:right;"> 0.0026 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> CSTpjuv </td>
   <td style="text-align:right;"> 0.550 </td>
   <td style="text-align:right;"> 0.581 </td>
   <td style="text-align:right;"> 31.94132 </td>
   <td style="text-align:right;"> -0.03 </td>
   <td style="text-align:right;"> 0.12 </td>
   <td style="text-align:right;"> 0.0406 </td>
   <td style="text-align:right;"> 0.2202 </td>
  </tr>
</tbody>
</table>

</div>
<div class="cell-output-display">

<table>
 <thead>
  <tr>
   <th style="text-align:left;"> var </th>
   <th style="text-align:right;"> RMSE_LOO </th>
   <th style="text-align:right;"> RMSE_LFO </th>
   <th style="text-align:right;"> AIC_LOO </th>
   <th style="text-align:right;"> rsq_LOO </th>
   <th style="text-align:right;"> rsq_LFO </th>
   <th style="text-align:right;"> dev.ex_LOO </th>
   <th style="text-align:right;"> dev.ex_LFO </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> PDOlarv </td>
   <td style="text-align:right;"> 0.504 </td>
   <td style="text-align:right;"> 0.203 </td>
   <td style="text-align:right;"> 31.25609 </td>
   <td style="text-align:right;"> -0.01 </td>
   <td style="text-align:right;"> -0.04 </td>
   <td style="text-align:right;"> 0.0439 </td>
   <td style="text-align:right;"> 0.0272 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> LSTlarv </td>
   <td style="text-align:right;"> 0.433 </td>
   <td style="text-align:right;"> 0.210 </td>
   <td style="text-align:right;"> 27.62118 </td>
   <td style="text-align:right;"> 0.18 </td>
   <td style="text-align:right;"> 0.15 </td>
   <td style="text-align:right;"> 0.2562 </td>
   <td style="text-align:right;"> 0.2382 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> DDpre </td>
   <td style="text-align:right;"> 0.460 </td>
   <td style="text-align:right;"> 0.210 </td>
   <td style="text-align:right;"> 29.95140 </td>
   <td style="text-align:right;"> 0.05 </td>
   <td style="text-align:right;"> 0.03 </td>
   <td style="text-align:right;"> 0.1015 </td>
   <td style="text-align:right;"> 0.0931 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> HCIlarv </td>
   <td style="text-align:right;"> 0.493 </td>
   <td style="text-align:right;"> 0.217 </td>
   <td style="text-align:right;"> 31.45804 </td>
   <td style="text-align:right;"> -0.02 </td>
   <td style="text-align:right;"> -0.04 </td>
   <td style="text-align:right;"> 0.0347 </td>
   <td style="text-align:right;"> 0.0240 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> DDlarv </td>
   <td style="text-align:right;"> 0.484 </td>
   <td style="text-align:right;"> 0.218 </td>
   <td style="text-align:right;"> 31.01117 </td>
   <td style="text-align:right;"> 0.01 </td>
   <td style="text-align:right;"> -0.02 </td>
   <td style="text-align:right;"> 0.0550 </td>
   <td style="text-align:right;"> 0.0456 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Tpart </td>
   <td style="text-align:right;"> 0.491 </td>
   <td style="text-align:right;"> 0.220 </td>
   <td style="text-align:right;"> 31.30430 </td>
   <td style="text-align:right;"> -0.01 </td>
   <td style="text-align:right;"> -0.03 </td>
   <td style="text-align:right;"> 0.0417 </td>
   <td style="text-align:right;"> 0.0331 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> dfa </td>
   <td style="text-align:right;"> 0.500 </td>
   <td style="text-align:right;"> 0.222 </td>
   <td style="text-align:right;"> 31.73622 </td>
   <td style="text-align:right;"> -0.03 </td>
   <td style="text-align:right;"> -0.05 </td>
   <td style="text-align:right;"> 0.0218 </td>
   <td style="text-align:right;"> 0.0124 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> BeutiTUMIpjuv </td>
   <td style="text-align:right;"> 0.502 </td>
   <td style="text-align:right;"> 0.231 </td>
   <td style="text-align:right;"> 31.98426 </td>
   <td style="text-align:right;"> -0.04 </td>
   <td style="text-align:right;"> -0.06 </td>
   <td style="text-align:right;"> 0.0102 </td>
   <td style="text-align:right;"> 0.0058 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> DDpjuv </td>
   <td style="text-align:right;"> 0.516 </td>
   <td style="text-align:right;"> 0.237 </td>
   <td style="text-align:right;"> 32.11044 </td>
   <td style="text-align:right;"> -0.05 </td>
   <td style="text-align:right;"> -0.07 </td>
   <td style="text-align:right;"> 0.0042 </td>
   <td style="text-align:right;"> 0.0005 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> DDben </td>
   <td style="text-align:right;"> 0.498 </td>
   <td style="text-align:right;"> 0.238 </td>
   <td style="text-align:right;"> 31.87787 </td>
   <td style="text-align:right;"> -0.04 </td>
   <td style="text-align:right;"> -0.05 </td>
   <td style="text-align:right;"> 0.0152 </td>
   <td style="text-align:right;"> 0.0128 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> MLDpjuv </td>
   <td style="text-align:right;"> 0.531 </td>
   <td style="text-align:right;"> 0.240 </td>
   <td style="text-align:right;"> 32.13528 </td>
   <td style="text-align:right;"> -0.05 </td>
   <td style="text-align:right;"> -0.06 </td>
   <td style="text-align:right;"> 0.0030 </td>
   <td style="text-align:right;"> 0.0026 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Tcop </td>
   <td style="text-align:right;"> 0.462 </td>
   <td style="text-align:right;"> 0.245 </td>
   <td style="text-align:right;"> 30.18503 </td>
   <td style="text-align:right;"> 0.04 </td>
   <td style="text-align:right;"> 0.04 </td>
   <td style="text-align:right;"> 0.0915 </td>
   <td style="text-align:right;"> 0.0963 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> CSTlarv </td>
   <td style="text-align:right;"> 0.526 </td>
   <td style="text-align:right;"> 0.248 </td>
   <td style="text-align:right;"> 32.19784 </td>
   <td style="text-align:right;"> -0.05 </td>
   <td style="text-align:right;"> -0.07 </td>
   <td style="text-align:right;"> 0.0001 </td>
   <td style="text-align:right;"> 0.0006 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> HCIpjuv </td>
   <td style="text-align:right;"> 0.516 </td>
   <td style="text-align:right;"> 0.253 </td>
   <td style="text-align:right;"> 31.86014 </td>
   <td style="text-align:right;"> -0.02 </td>
   <td style="text-align:right;"> -0.05 </td>
   <td style="text-align:right;"> 0.0513 </td>
   <td style="text-align:right;"> 0.0224 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> LSTpjuv </td>
   <td style="text-align:right;"> 0.501 </td>
   <td style="text-align:right;"> 0.261 </td>
   <td style="text-align:right;"> 32.18613 </td>
   <td style="text-align:right;"> -0.05 </td>
   <td style="text-align:right;"> -0.06 </td>
   <td style="text-align:right;"> 0.0006 </td>
   <td style="text-align:right;"> 0.0069 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> CutiTUMIpjuv </td>
   <td style="text-align:right;"> 0.493 </td>
   <td style="text-align:right;"> 0.262 </td>
   <td style="text-align:right;"> 32.18672 </td>
   <td style="text-align:right;"> -0.05 </td>
   <td style="text-align:right;"> -0.06 </td>
   <td style="text-align:right;"> 0.0006 </td>
   <td style="text-align:right;"> 0.0072 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> DDegg </td>
   <td style="text-align:right;"> 0.479 </td>
   <td style="text-align:right;"> 0.266 </td>
   <td style="text-align:right;"> 31.09455 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.00 </td>
   <td style="text-align:right;"> 0.0512 </td>
   <td style="text-align:right;"> 0.0636 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> BeutiSTIpjuv </td>
   <td style="text-align:right;"> 0.506 </td>
   <td style="text-align:right;"> 0.275 </td>
   <td style="text-align:right;"> 31.20045 </td>
   <td style="text-align:right;"> 0.02 </td>
   <td style="text-align:right;"> 0.05 </td>
   <td style="text-align:right;"> 0.0943 </td>
   <td style="text-align:right;"> 0.1483 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> MLDpart </td>
   <td style="text-align:right;"> 0.473 </td>
   <td style="text-align:right;"> 0.293 </td>
   <td style="text-align:right;"> 28.64629 </td>
   <td style="text-align:right;"> 0.11 </td>
   <td style="text-align:right;"> 0.13 </td>
   <td style="text-align:right;"> 0.1556 </td>
   <td style="text-align:right;"> 0.1874 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> X </td>
   <td style="text-align:right;"> 0.482 </td>
   <td style="text-align:right;"> 0.295 </td>
   <td style="text-align:right;"> 30.19527 </td>
   <td style="text-align:right;"> 0.06 </td>
   <td style="text-align:right;"> 0.04 </td>
   <td style="text-align:right;"> 0.1178 </td>
   <td style="text-align:right;"> 0.1013 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> ONIpjuv </td>
   <td style="text-align:right;"> 0.483 </td>
   <td style="text-align:right;"> 0.309 </td>
   <td style="text-align:right;"> 30.48603 </td>
   <td style="text-align:right;"> 0.03 </td>
   <td style="text-align:right;"> 0.06 </td>
   <td style="text-align:right;"> 0.0783 </td>
   <td style="text-align:right;"> 0.1153 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> MLDlarv </td>
   <td style="text-align:right;"> 0.436 </td>
   <td style="text-align:right;"> 0.328 </td>
   <td style="text-align:right;"> 27.37569 </td>
   <td style="text-align:right;"> 0.16 </td>
   <td style="text-align:right;"> 0.23 </td>
   <td style="text-align:right;"> 0.2052 </td>
   <td style="text-align:right;"> 0.3036 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> PDOpjuv </td>
   <td style="text-align:right;"> 0.486 </td>
   <td style="text-align:right;"> 0.349 </td>
   <td style="text-align:right;"> 31.75613 </td>
   <td style="text-align:right;"> -0.03 </td>
   <td style="text-align:right;"> 0.01 </td>
   <td style="text-align:right;"> 0.0209 </td>
   <td style="text-align:right;"> 0.0697 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> CutiSTIpjuv </td>
   <td style="text-align:right;"> 0.432 </td>
   <td style="text-align:right;"> 0.389 </td>
   <td style="text-align:right;"> 24.94231 </td>
   <td style="text-align:right;"> 0.28 </td>
   <td style="text-align:right;"> 0.39 </td>
   <td style="text-align:right;"> 0.3494 </td>
   <td style="text-align:right;"> 0.4616 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> ONIpre </td>
   <td style="text-align:right;"> 0.499 </td>
   <td style="text-align:right;"> 0.463 </td>
   <td style="text-align:right;"> 29.86055 </td>
   <td style="text-align:right;"> 0.09 </td>
   <td style="text-align:right;"> 0.23 </td>
   <td style="text-align:right;"> 0.1665 </td>
   <td style="text-align:right;"> 0.3226 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> CSTpjuv </td>
   <td style="text-align:right;"> 0.550 </td>
   <td style="text-align:right;"> 0.581 </td>
   <td style="text-align:right;"> 31.94132 </td>
   <td style="text-align:right;"> -0.03 </td>
   <td style="text-align:right;"> 0.12 </td>
   <td style="text-align:right;"> 0.0406 </td>
   <td style="text-align:right;"> 0.2202 </td>
  </tr>
</tbody>
</table>

</div>
</div>
<p>We find that the models supported with AIC and LOO-CV are very consistent and agree with the linear models, but LFO-CV is a bit of a mess. Lets look at the model fits for the full time series:</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="LinearModelsDredge_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid" width="1056"></p>
</div>
</div>
<p>Looking at this, it becomes pretty obvious that the variables with the most support are not necessarily the ones that predict whether recruitment will be above or below average in the last few years, but rather the ones that just go in the middle of a bunch of points that are centered close to the mean. No variable does a great job predicting 2010, but CUTI STI, BEUTI STI, and ONI pre at least capture some patterns in below average.</p>
</section>
<section id="next-steps" class="level2">
<h2 class="anchored" data-anchor-id="next-steps">Next steps</h2>
<ol type="1">
<li><p>Fit GAMs with temporally stable relationships (status: <strong>done</strong>)</p></li>
<li><p>Perform model selection using LFO-CV (status: <strong>done</strong>)</p></li>
<li><p>Evaluate marginal improvement of RMSE for multivariate GAMs and LMs (status: <strong>done</strong>)</p></li>
<li><p>Evaluate non-stationary relationships between recruitment deviations and the environmental predictors with the most support to assess non-stationarity (status: <strong>in development</strong>)</p></li>
<li><p>Develop a method for a rolling window LFO-CV to address and test challenged outlined above (status: <strong>in development</strong>)</p></li>
<li><p>Fit models using regularization techniques (status: <strong>to do</strong>)</p></li>
<li><p>Fit models using machine learning techniques (status: <strong>to do, low priority</strong>)</p></li>
</ol>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>